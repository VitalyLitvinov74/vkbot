const VkBot = require('node-vk-bot-api')
//Ğ¢Ñ€ĞµĞ¹Ğ´Ğ¸Ğ½Ğ³ Ñ ÑƒĞ¼Ğ¾Ğ¼. https://vk.com/tradingsymom
const group_id = 190351055;
const bot = new VkBot({
    token: 'dd9c1066b305289df0ac759f4c4374fe11b10d3b0c206203b117ed1b448d867d5a70a7ab200cfdab486d8',
    execute_timeout: 5000
});

const messages = [
    `ĞĞ¸Ñ‡ĞµĞ³Ğ¾ÑÑ‚Ñ€Ğ°ÑˆĞ½Ğ¾Ğ³Ğ¾,Ñ‡Ñ‚Ğ¾ÑƒĞ²Ğ°ÑĞ½ĞµÑ‚Ğ¾Ğ¿Ñ‹Ñ‚Ğ°,Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼ÑƒÑ‡Ñ‚Ğ¾80%ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ²Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¾Ğ¹Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹Ñ‚Ğ°ĞºĞ¸ĞµĞ¶ĞµĞ¸Ğ¸Ğ¼ÑÑ‚Ğ¾Ğ½ĞµĞ¼ĞµÑˆĞ°ĞµÑ‚!Ğ’Ğ½Ğ°ÑˆĞµĞ¹ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ,ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹ĞµÑĞ¸Ğ³Ğ½Ğ°Ğ»Ñ‹(ÑĞ´ĞµĞ»ĞºĞ¸ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹ĞµÑĞ·Ğ°ĞºĞ»ÑÑ‡Ğ°ÑĞ¸Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€ÑƒÑĞ²Ğ°Ğ¼),ĞµÑ‰ĞµĞµÑÑ‚ÑŒĞ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ñ‹Ñ…Ğ¼ĞµÑÑ‚.ĞŸĞµÑ€ĞµĞ¹Ğ´ÑĞ¿Ğ¾ÑÑÑ‹Ğ»ĞºĞµ,Ğ²Ñ‹Ğ¿Ğ¾Ğ¹Ğ¼Ñ‘Ñ‚ĞµÑ‚Ğ¾,Ñ‡ĞµĞ¼ÑĞ·Ğ°Ğ½Ğ¸Ğ¼Ğ°ÑÑÑŒÑ‡Ñ‚Ğ¾Ğ±Ñ‹Ğ±Ñ‹Ñ‚ÑŒĞ²ĞºÑƒÑ€ÑĞµĞ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´ÑÑ‰ĞµĞ³Ğ¾:https://vk.com/topic-190351055_40896137Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ»Ñ‹ÑĞ´Ğ°ÑĞ‘Ğ•Ğ¡ĞŸĞ›ĞĞ¢ĞĞĞŸĞ¾Ñ‡ĞµĞ¼ÑƒĞ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾?Ğ”Ğ°Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼ÑƒÑ‡Ñ‚Ğ¾Ğ»ĞµĞ³Ñ‡ĞµĞ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ñ‚ÑŒ%Ğ·Ğ°Ñ‚Ğ¾,Ñ‡Ñ‚Ğ¾Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑˆÑŒÑ‡ĞµĞ»Ğ¾Ğ²ĞµĞºÑƒ,Ñ‡ĞµĞ¼Ğ±Ñ€Ğ°Ñ‚ÑŒÑĞ½ĞµĞ³Ğ¾Ğ´ĞµĞ½ÑŒĞ³Ğ¸,ĞºĞ¾Ğ³Ğ´Ğ°Ğ¾Ğ½Ğ´Ğ°Ğ¶ĞµĞ½ĞµĞ·Ğ½Ğ°ĞµÑ‚,Ğ·Ğ°Ñ‡Ñ‚Ğ¾Ğ±ÑƒĞ´ĞµÑ‚Ğ¿Ğ»Ğ°Ñ‚Ğ¸Ñ‚ÑŒ...Ğ¢ĞµĞ¿ĞµÑ€ÑŒĞ´Ğ°Ğ¹Ñ‚ĞµĞ¾Ñ‚Ğ²ĞµÑ‚,Ğ¶ĞµĞ»Ğ°ĞµÑ‚ĞµĞ»Ğ¸Ğ²Ñ‹ĞºĞ¾Ğ¼Ğ½ĞµĞ²ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ?`,
    `Ğ¢Ğ¾,Ñ‡Ñ‚Ğ¾ÑƒĞ²Ğ°ÑĞµÑÑ‚ÑŒĞ¾Ğ¿Ñ‹Ñ‚,ÑÑ‚Ğ¾Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹Ğ¿Ğ»ÑÑĞ¢Ğ°ĞºĞºĞ°ĞºÑƒĞ²Ğ°ÑĞµÑÑ‚ÑŒĞ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸ĞµĞ¸Ğ¾Ğ¿Ñ‹Ñ‚,Ğ²Ğ°Ğ¼Ğ±ÑƒĞ´ĞµÑ‚Ğ½Ğ°Ğ¼Ğ½Ğ¾Ğ³Ğ¾Ğ¿Ñ€Ğ¾Ñ‰ĞµÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒĞ¿Ğ¾Ğ¼Ğ¾Ğ¸Ğ¼ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ°Ğ¼Ğ£ÑĞ»Ğ¾Ğ²Ğ¸ÑĞ¿Ğ¾Ğ¿Ğ°Ğ´Ğ°Ğ½Ğ¸ÑĞ²Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚ÑƒÑĞ³Ñ€ÑƒĞ¿Ğ¿ÑƒĞ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹:1.Ğ’Ğ°Ğ¼Ğ½ÑƒĞ¶Ğ½Ğ¾Ğ±ÑƒĞ´ĞµÑ‚Ğ¿Ñ€Ğ¾Ğ¹Ñ‚Ğ¸Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸ÑĞ¿Ğ¾Ğ¼Ğ¾ĞµĞ¹ÑÑÑ‹Ğ»ĞºĞµĞ½Ğ°BINARIUM2.Ğ­Ñ‚Ğ¾Ğ½ÑƒĞ¶Ğ½Ğ¾Ğ´Ğ»ÑÑ‚Ğ¾Ğ³Ğ¾,Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ÑĞ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ğ»5%Ğ¾Ñ‚Ñ‚Ğ¾Ğ³Ğ¾,Ñ‡Ñ‚Ğ¾Ğ²Ñ‹Ğ²Ğ¾Ğ¶ÑƒĞ²Ğ°ÑĞ²Ğ¿Ğ»ÑÑĞ•ÑĞ»Ğ¸Ğ½ĞµÑ‚Ğ´Ğ¾Ğ²ĞµÑ€Ğ¸ÑĞºĞ¾Ğ¼Ğ½Ğµ,Ğ¼Ğ¾Ğ¶ĞµÑ‚ĞµĞ¾Ğ·Ğ½Ğ°ĞºĞ¾Ğ¼Ğ¸Ñ‚ÑŒÑÑÑĞ¾ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¾Ğ¹Ğ¼Ğ¾ĞµĞ¹ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹-https://vk.com/club173988367-https://vk.com/club173988367ĞÑ‚ĞµĞ¿ĞµÑ€ÑŒÑĞ¶Ğ´ÑƒĞ¾Ñ‚Ğ²Ğ°ÑĞ¾Ñ‚Ğ²ĞµÑ‚Ğ°Ğ•ÑĞ»Ğ¸Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹,Ñ‚Ğ¾Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚ĞµÂ«Ğ´Ğ°Â»Ğ•ÑĞ»Ğ¸Ğ½ĞµÑ‚,Ñ‚Ğ¾Ñ‚Ğ°ĞºĞ¸ÑĞºĞ°Ğ¶Ğ¸Ñ‚ĞµÂ«Ğ½ĞµÑ‚Â»ĞŸĞ¾Ñ‚Ğ¾Ğ¼ÑƒÑ‡Ñ‚Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸ĞµÑĞ²Ğ°Ğ¼Ğ¸Ğ²ĞµĞ´Ñ‘Ñ‚Ğ¶Ğ¸Ğ²Ğ¾Ğ¹Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞºğŸ˜Œ`,
    `ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ”Ğ°Ğ²Ğ°Ğ¹Ñ‚ĞµĞ½Ğ°Ñ‡Ğ½ĞµĞ¼ÑÑ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸Ğ½Ğ°Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğµ,Ğ³Ğ´ĞµĞ¼Ñ‹Ğ±ÑƒĞ´ĞµĞ¼Ñ‚Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ°Ñ‚ÑŒ.ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ğ¹Ğ±Ñ€Ğ¾ĞºĞµÑ€,Ğ½Ğ°ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ¾Ğ¼ÑÑ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑƒĞ¶ĞµĞ±Ğ¾Ğ»ĞµĞµĞ³Ğ¾Ğ´Ğ°.https://vk.cc/9cPCtUĞŸĞ¾ÑĞ»ĞµÑ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸Ğ¿Ñ€Ğ¸ÑˆĞ»Ğ¸Ñ‚ĞµÑÑĞ´Ğ°ÑĞ²Ğ¾Ğ¹ID.Ğ’Ñ‹ĞµĞ³Ğ¾Ğ½Ğ°Ğ¹Ğ´ĞµÑ‚ĞµĞ²Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğµ"ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ".Ğ­Ñ‚Ğ¾Ğ½ÑƒĞ¶Ğ½Ğ¾,Ñ‡Ñ‚Ğ¾Ğ±Ñ‹Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒĞ¿Ğ¾Ñ€ÑĞ´ĞºĞ¾Ğ²Ñ‹Ğ¹Ğ½Ğ¾Ğ¼ĞµÑ€Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸.ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:Â«id1337790Â»ĞšĞ°ĞºĞ¿Ñ€Ğ¾Ğ¹Ğ´Ñ‘Ñ‚ĞµÑ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ,Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚ĞµÑÑĞ´Ğ°.`,
    `ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾,Ñ‚ĞµĞ¿ĞµÑ€ÑŒĞ²Ğ°Ğ¼Ğ¾ÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒĞ¿Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒÑĞ²Ğ¾Ğ¹ÑÑ‡Ñ‘Ñ‚Ğ¸Ğ²Ğ°ÑĞ´Ğ¾Ğ±Ğ°Ğ²ÑÑ‚Ğ²Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚ÑƒÑĞ³Ñ€ÑƒĞ¿Ğ¿ÑƒĞ¸Ğ²Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹Ñ‚ĞµĞ»ĞµĞ³Ñ€Ğ°Ğ¼Ğ¼ĞºĞ°Ğ½Ğ°Ğ»!Ğ¡ÑƒĞ¼Ğ¼ÑƒĞ¿Ğ¾Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸ÑĞ²Ñ‹Ğ²Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ĞµÑĞ°Ğ¼Ğ¸.(ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ĞµĞ¿Ğ¾Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸ĞµÑÑ‡ĞµÑ‚Ğ°ÑĞ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚5$Ğ¸Ğ»Ğ¸300Ñ€ÑƒĞ±Ğ»ĞµĞ¹Ğ Ğ¾ÑÑĞ¸Ğ¸)ĞŸĞ¾ÑĞ»ĞµĞ¿Ğ¾Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸ÑĞ½ĞµĞ·Ğ°Ğ±ÑƒĞ´ÑŒÑ‚ĞµĞ½Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒÑÑĞ´Ğ°,ÑÑ‚Ğ¾Ğ²Ğ°Ğ¶Ğ½Ğ¾!https://vk.com/club173988367ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°Ğ¼Ğ¾ĞµĞ¹Ñ‚Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ»Ğ¸!https://m.vk.com/topic-190351055_40770840Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ñ‹Ğ¾Ğ±Ğ¾Ğ¼Ğ½Ğµ!`
];

const notif = [
    `, Ñ‡Ñ‚Ğ¾ ÑĞºĞ°Ğ¶ĞµÑ‚Ğµ? Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ğ±ÑƒĞ´ĞµĞ¼?`,
    `, Ñ‡Ñ‚Ğ¾ ÑĞºĞ°Ğ¶ĞµÑ‚Ğµ? Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ğ±ÑƒĞ´ĞµĞ¼?`,
    `, ĞºĞ¾Ğ³Ğ´Ğ° ÑĞ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ?`,
    `, ĞºĞ¾Ğ³Ğ´Ğ° ÑĞ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ¿Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ ÑÑ‡Ñ‘Ñ‚?`,
]

let pendings = {};

let users = {};

function deletePending(user_id) {
    clearInterval(pendings[user_id]);
    return delete pendings[user_id];
}

function deleteUserNotif(user_id) {
    clearTimeout(users[user_id]);
    return delete users[user_id];
}

async function newPending(msg_id, user_id, messageIndex) {
    const user = await bot.execute('users.get', {
        user_id: user_id,
    });
    pendings[user_id] = setInterval(async () => {
        const msg = await bot.execute('messages.getById', {
            message_ids: msg_id
        });
        if (!msg.items) {
            console.log(msg);
            return deletePending(user_id);
        }
        if (msg.items[0].read_state === 1) {
            users[user_id] = setTimeout(async () => {
                const msgAllowed = await bot.execute('messages.isMessagesFromGroupAllowed', {
                    group_id: Number(group_id),
                    user_id: Number(user_id)
                });
                if (msgAllowed.is_allowed === 0) {
                    deleteUserNotif(user_id);
                    return deletePending(user_id);
                }
                try {
                    bot.sendMessage(user_id, `${user[0].first_name}${notif[messageIndex]}`);
                } catch (err) {
                    console.log(err);
                }
                deleteUserNotif(user_id);
                return deletePending(user_id);
            }, 60000 * 90); //60000 * 90
        }
    }, 60000 * 2) //60000
}

bot.event('message_reply', async ctx => {
    //return console.log(String(ctx.message.body).split("\n").join("").split(" ").join(""));
    if (pendings[ctx.message.user_id]) return;
    if (users[ctx.message.user_id]) return;
    for (let i = 0; i < messages.length; i++) {
        if (messages[i] === String(ctx.message.body).split("\n").join("").split(" ").join("")) {
            return newPending(ctx.message.id, ctx.message.user_id, i);
        }
    }
});

bot.event('message_new', ctx => {
    if (pendings[ctx.message.user_id]) {
        return deletePending(ctx.message.user_id);
    }
    if (users[ctx.message.user_id]) {
        return deleteUserNotif(ctx.message.user_id);
    }
    return;
})

bot.startPolling();
