const VkBot = require('node-vk-bot-api')
//Ğ¡ĞµÑ€Ğ¸Ğ¹Ğ½Ñ‹Ğ¹ Ñ„Ğ¸Ğ½Ğ°Ğ½ÑĞ¸ÑÑ‚. https://vk.com/fin_white
const group_id = 85975456;
const bot = new VkBot({
    token: 'bb9ebaede1c3498d0ae5c8d143226bfd9d0acbe3bd49b69c87b0a0bf3b18f6a2c70ce3227e4f53cbe8d4e',
    execute_timeout: 5000
});

const messages = [
    `Ğ’Ğ¼Ğ¾ĞµĞ¹ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ,ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹ĞµÑĞ¸Ğ³Ğ½Ğ°Ğ»Ñ‹(ÑĞ´ĞµĞ»ĞºĞ¸ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹ĞµÑĞ·Ğ°ĞºĞ»ÑÑ‡Ğ°ÑĞ¸Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€ÑƒÑĞ²Ğ°Ğ¼),ĞµÑ‰ĞµĞµÑÑ‚ÑŒĞ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ñ‹Ñ…Ğ¼ĞµÑÑ‚.Ğ¯Ğ¿Ğ¾ĞºĞ°Ñ‡Ñ‚Ğ¾Ğ¼Ğ¾Ğ³ÑƒĞ¿Ñ€Ğ¸Ğ½ÑÑ‚ÑŒĞ½Ğ¾Ğ²Ğ¸Ñ‡ĞºĞ¾Ğ²,ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹ĞµĞ±ÑƒĞ´ÑƒÑ‚Ñ€Ğ°Ğ·Ğ²Ğ¸Ğ²Ğ°Ñ‚ÑŒÑÑĞ²Ğ¼ĞµÑÑ‚ĞµÑĞ¾Ğ¼Ğ½Ğ¾Ğ¹.ĞŸÑ€Ğ¸ÑÑ‚Ğ¾Ğ¼,Ğ´Ğ»ÑĞ¼ĞµĞ½ÑĞ½ĞµĞ¸Ğ¼ĞµĞµÑ‚Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸ÑĞºĞ°ĞºĞ¾Ğ¹ÑƒÑ‚ĞµĞ±ÑÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒĞ·Ğ½Ğ°Ğ½Ğ¸Ğ¹.Ğ˜ÑÑ‚Ğ¾Ğ²ÑĞµĞ‘Ğ•Ğ¡ĞŸĞ›ĞĞ¢ĞĞĞŸĞ¾Ñ‡ĞµĞ¼ÑƒĞ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾?Ğ”Ğ°Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼ÑƒÑ‡Ñ‚Ğ¾Ğ»ĞµĞ³Ñ‡ĞµĞ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ñ‚ÑŒ%Ğ·Ğ°Ñ‚Ğ¾,Ñ‡Ñ‚Ğ¾Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑˆÑŒÑ‡ĞµĞ»Ğ¾Ğ²ĞµĞºÑƒ,Ñ‡ĞµĞ¼Ğ±Ñ€Ğ°Ñ‚ÑŒÑĞ½ĞµĞ³Ğ¾Ğ´ĞµĞ½ÑŒĞ³Ğ¸,ĞºĞ¾Ğ³Ğ´Ğ°Ğ¾Ğ½Ğ´Ğ°Ğ¶ĞµĞ½ĞµĞ·Ğ½Ğ°ĞµÑ‚,Ğ·Ğ°Ñ‡Ñ‚Ğ¾Ğ±ÑƒĞ´ĞµÑ‚Ğ¿Ğ»Ğ°Ñ‚Ğ¸Ñ‚ÑŒ...CĞ¾ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¾Ğ¹Ğ¼Ğ¾Ğ¸Ñ…ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ²Ñ‚Ñ‹Ğ¼Ğ¾Ğ¶ĞµÑˆÑŒĞ¾Ğ·Ğ½Ğ°ĞºĞ¾Ğ¼Ğ¸Ñ‚ÑŒÑÑĞ²Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾Ğ¼TelegramĞºĞ°Ğ½Ğ°Ğ»ĞµğŸ”¥https://teledur.ru/joinchat/AAAAAFFOpbWsMxhfXoPG9gĞ¢ĞµĞ¿ĞµÑ€ÑŒĞ¾Ñ‚Ğ²ĞµÑ‚ÑŒĞ½Ğ°Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ,Ñ‚Ñ‹Ğ¶ĞµĞ»Ğ°ĞµÑˆÑŒĞºĞ¾Ğ¼Ğ½ĞµĞ²Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚ÑƒÑĞ³Ñ€ÑƒĞ¿Ğ¿Ñƒ?`,
    `Ğ¢Ğ¾,Ñ‡Ñ‚Ğ¾ÑƒĞ²Ğ°ÑĞµÑÑ‚ÑŒĞ¾Ğ¿Ñ‹Ñ‚,ÑÑ‚Ğ¾Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹Ğ¿Ğ»ÑÑĞ¢Ğ°ĞºĞºĞ°ĞºÑƒĞ²Ğ°ÑĞµÑÑ‚ÑŒĞ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸ĞµĞ¸Ğ¾Ğ¿Ñ‹Ñ‚,Ğ²Ğ°Ğ¼Ğ±ÑƒĞ´ĞµÑ‚Ğ½Ğ°Ğ¼Ğ½Ğ¾Ğ³Ğ¾Ğ¿Ñ€Ğ¾Ñ‰ĞµÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒĞ¿Ğ¾Ğ¼Ğ¾Ğ¸Ğ¼ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ°Ğ¼Ğ£ÑĞ»Ğ¾Ğ²Ğ¸ÑĞ¿Ğ¾Ğ¿Ğ°Ğ´Ğ°Ğ½Ğ¸ÑĞ²Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚ÑƒÑĞ³Ñ€ÑƒĞ¿Ğ¿ÑƒĞ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹:1.Ğ’Ğ°Ğ¼Ğ½ÑƒĞ¶Ğ½Ğ¾Ğ±ÑƒĞ´ĞµÑ‚Ğ¿Ñ€Ğ¾Ğ¹Ñ‚Ğ¸Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸ÑĞ¿Ğ¾Ğ¼Ğ¾ĞµĞ¹ÑÑÑ‹Ğ»ĞºĞµĞ½Ğ°BINARIUM2.Ğ­Ñ‚Ğ¾Ğ½ÑƒĞ¶Ğ½Ğ¾Ğ´Ğ»ÑÑ‚Ğ¾Ğ³Ğ¾,Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ÑĞ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ğ»2.5%Ğ¾Ñ‚Ñ‚Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ¾Ğ³Ğ¾Ğ¾Ğ±Ğ¾Ñ€Ğ¾Ñ‚Ğ°CĞ¾ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¾Ğ¹Ğ¼Ğ¾Ğ¸Ñ…ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ²Ñ‚Ñ‹Ğ¼Ğ¾Ğ¶ĞµÑˆÑŒĞ¾Ğ·Ğ½Ğ°ĞºĞ¾Ğ¼Ğ¸Ñ‚ÑŒÑÑĞ²Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾Ğ¼TelegramĞºĞ°Ğ½Ğ°Ğ»ĞµğŸ”¥-https://teledur.ru/joinchat/AAAAAFFOpbWsMxhfXoPG9gĞÑ‚ĞµĞ¿ĞµÑ€ÑŒÑĞ¶Ğ´ÑƒĞ¾Ñ‚Ğ²Ğ°ÑĞ¾Ñ‚Ğ²ĞµÑ‚Ğ°Ğ•ÑĞ»Ğ¸Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹,Ñ‚Ğ¾Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚ĞµÂ«Ğ´Ğ°Â»Ğ•ÑĞ»Ğ¸Ğ½ĞµÑ‚,Ñ‚Ğ¾Ñ‚Ğ°ĞºĞ¸ÑĞºĞ°Ğ¶Ğ¸Ñ‚ĞµÂ«Ğ½ĞµÑ‚Â»ĞŸĞ¾Ñ‚Ğ¾Ğ¼ÑƒÑ‡Ñ‚Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸ĞµÑĞ²Ğ°Ğ¼Ğ¸Ğ²ĞµĞ´Ñ‘Ñ‚Ğ¶Ğ¸Ğ²Ğ¾Ğ¹Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞºğŸ˜Œ`,
    `Ğ”Ğ°Ğ²Ğ°Ğ¹Ñ‚ĞµĞ½Ğ°Ñ‡Ğ½ĞµĞ¼ÑÑ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ÑƒĞ±Ñ€Ğ¾ĞºĞµÑ€Ğ°,Ğ³Ğ´ĞµĞ±ÑƒĞ´ĞµĞ¼Ñ‚Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ°Ñ‚ÑŒ.Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞ¹Ñ‚ĞµÑÑŒÑƒĞ±Ñ€Ğ¾ĞºĞµÑ€Ğ°BinariumĞ¿Ğ¾ÑÑÑ‹Ğ»ĞºĞµĞ½Ğ¸Ğ¶Ğµ.https://vk.cc/aes1apĞŸĞ¾ÑĞ»ĞµÑ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸Ğ¿Ñ€Ğ¸ÑˆĞ»Ğ¸Ñ‚ĞµĞ¼Ğ½ĞµÑÑĞ´Ğ°ÑĞ²Ğ¾Ğ¹ID.Ğ’Ñ‹ĞµĞ³Ğ¾Ğ½Ğ°Ğ¹Ğ´ĞµÑ‚ĞµĞ²Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğµ"ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ".Ğ­Ñ‚Ğ¾Ğ½ÑƒĞ¶Ğ½Ğ¾,Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ÑĞ¼Ğ¾Ğ³Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒĞ²Ğ°ÑˆĞ¿Ğ¾Ñ€ÑĞ´ĞºĞ¾Ğ²Ñ‹Ğ¹Ğ½Ğ¾Ğ¼ĞµÑ€Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸.ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:Â«id1337790Â»ĞšĞ°ĞºĞ¿Ñ€Ğ¾Ğ¹Ğ´Ñ‘Ñ‚ĞµÑ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ,Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚ĞµÑÑĞ´Ğ°.`,
    `ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾,Ğ¾ÑÑ‚Ğ°Ğ»ÑÑÑ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ÑˆĞ°Ğ³ĞŸĞ¾Ğ¿Ğ¾Ğ»Ğ½ÑĞ¹Ñ‚ĞµÑĞ²Ğ¾Ğ¹ÑÑ‡Ñ‘Ñ‚Ğ½Ğ°Ğ»ÑĞ±ÑƒÑÑÑƒĞ¼Ğ¼Ñƒ(ĞœĞ¾Ğ¶ĞµÑˆÑŒĞ´Ğ°Ğ¶ĞµĞ½Ğ°Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ğ¹Ğ¼Ğ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼Ğ±Ñ€Ğ¾ĞºĞµÑ€Ğ°!)Ğ¸Ñ‚Ñ‹Ğ²Ğ¼Ğ¾ĞµĞ¹ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ,Ğ³Ğ´ĞµĞ±ÑƒĞ´ĞµÑˆÑŒĞ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ñ‚ÑŒÑĞ¸Ğ³Ğ½Ğ°Ğ»Ñ‹ÑĞ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒÑĞ¾Ñ‚80%ĞĞµĞ·Ğ°Ğ±ÑƒĞ´ÑŒĞ½Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒÑÑĞ´Ğ°,ĞºĞ°ĞºĞ¿Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸ÑˆÑŒÑĞ²Ğ¾Ğ¹ÑÑ‡Ñ‘Ñ‚Ğ¸Ğ½ĞµÑ‚ÑĞ½Ğ¸ÑÑÑ‚Ğ¸Ğ¼,Ğ²ĞµĞ´ÑŒĞ·Ğ°Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒÑ‚Ñ‹Ğ¼Ğ¾Ğ¶ĞµÑˆÑŒÑƒĞ¶ĞµÑĞµĞ³Ğ¾Ğ´Ğ½Ñ!`
];

const notif = [
    `, Ğ½Ñƒ ĞºĞ°Ğº Ğ¾Ğ·Ğ½Ğ°ĞºĞ¾Ğ¼Ğ¸Ğ»Ğ¸ÑÑŒ Ñ Ğ¼Ğ¾ĞµĞ¹ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¾Ğ¹ ? Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ğ±ÑƒĞ´ĞµĞ¼?`,
    `, Ğ½Ñƒ ĞºĞ°Ğº Ğ¾Ğ·Ğ½Ğ°ĞºĞ¾Ğ¼Ğ¸Ğ»Ğ¸ÑÑŒ Ñ Ğ¼Ğ¾ĞµĞ¹ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¾Ğ¹ ? Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ğ±ÑƒĞ´ĞµĞ¼?`,
    `, ĞºĞ¾Ğ³Ğ´Ğ° ÑĞ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ¿Ñ€Ğ¾Ğ¹Ñ‚Ğ¸ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ?`,
    `, ĞºĞ¾Ğ³Ğ´Ğ° ÑĞ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ¿Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ ÑÑ‡Ñ‘Ñ‚?`,
]

let pendings = {};

let users = {};

function deletePending(user_id) {
    clearInterval(pendings[user_id]);
    return delete pendings[user_id];
}

function deleteUserNotif(user_id) {
    clearTimeout(users[user_id]);
    return delete users[user_id];
}

async function newPending(msg_id, user_id, messageIndex) {
    const user = await bot.execute('users.get', {
        user_id: user_id,
    });
    pendings[user_id] = setInterval(async () => {
        const msg = await bot.execute('messages.getById', {
            message_ids: msg_id
        });
        if (!msg.items) {
            console.log(msg);
            return deletePending(user_id);
        }
        if (msg.items[0].read_state === 1) {
            users[user_id] = setTimeout(async () => {
                const msgAllowed = await bot.execute('messages.isMessagesFromGroupAllowed', {
                    group_id: Number(group_id),
                    user_id: Number(user_id)
                });
                if (msgAllowed.is_allowed === 0) {
                    deleteUserNotif(user_id);
                    return deletePending(user_id);
                }
                try {
                    bot.sendMessage(user_id, `${user[0].first_name}${notif[messageIndex]}`);
                } catch (err) {
                    console.log(err);
                }
                deleteUserNotif(user_id);
                return deletePending(user_id);
            }, 60000 * 90); //60000 * 90
        }
    }, 60000 * 2) //60000
}

bot.event('message_reply', async ctx => {
    //return console.log(String(ctx.message.body).split("\n").join("").split(" ").join(""));
    if (pendings[ctx.message.user_id]) return;
    if (users[ctx.message.user_id]) return;
    for (let i = 0; i < messages.length; i++) {
        if (messages[i] === String(ctx.message.body).split("\n").join("").split(" ").join("")) {
            return newPending(ctx.message.id, ctx.message.user_id, i);
        }
    }
});

bot.event('message_new', ctx => {
    if (pendings[ctx.message.user_id]) {
        return deletePending(ctx.message.user_id);
    }
    if (users[ctx.message.user_id]) {
        return deleteUserNotif(ctx.message.user_id);
    }
    return;
})

bot.startPolling();
